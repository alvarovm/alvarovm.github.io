Content-Type: text/x-zim-wiki
Wiki-Format: zim 0.4
Creation-Date: 2016-08-24T17:46:49-05:00

====== CP2K ======
Created Wednesday 24 August 2016

CP2K in BGQ

For version 2.5, you have to change source code slightly to pass compile with ibm compiler. In file src/sockets.c, remove the underscore for function 'slock' and 'swait', that is,
 
 int slock(int *node, int *ionode) { return 0; }
 int swait(int *usec, int *node, int *ionode) { return 0; }
 
 Or you can add a new Macro to guide preprocessor. 
 
 This is file Linux-bgq-ibm.psmp, just insert it into your arch directory:
 
'''
CC       = bgxlc_r
CPP      = cpp -traditional -E
#CPP      = /opt/ibmcmp/xlf/bg/11.1/exe/cpp -traditional -E 
FC       = /bgsys/drivers/ppcfloor/comm/xl/bin/mpixlf95_r -qstacktemp=1 -qsuffix=f=F:cpp=f90
LD       = /bgsys/drivers/ppcfloor/comm/xl/bin/mpixlf95_r -qstacktemp=1
AR       = ar -r
DFLAGS   = -DAIX -DESSL -DFFTSG -DFFTW3 -Dparallel -DLIBINT -DBLACS -DSCALAPACK -I/gpfs/vesta-home/wjiang/fftw3_double/include
CPPFLAGS = -C $(DFLAGS) -P
#FCFLAGS  = -qsmp=omp:noauto -O3 -qhot=level=0 -qsimd=auto -qarch=qp -qtune=qp -qmaxmem=-1 -qextname=wrapper_build_deriv1_eri:wrapper_build_eri:wrapper_free_libderiv:wrapper_free_libint:wrapper_init_deriv:wrapper_init_lib
FCFLAGS  = -qsmp=omp -O3 -qarch=qp -qtune=qp -qextname=wrapper_build_deriv1_eri:wrapper_build_eri:wrapper_free_libderiv:wrapper_free_libint:wrapper_init_deriv:wrapper_init_lib
#FCFLAGS  = -qsmp=omp -O3 -qarch=qp -qtune=qp -qunroll -qinline -qipa -qprefetch -qextname=wrapper_build_deriv1_eri:wrapper_build_eri:wrapper_free_libderiv:wrapper_free_libint:wrapper_init_deriv:wrapper_init_lib
LDFLAGS  = $(FCFLAGS) -Wl,--allow-multiple-definition,--relax
 
LIBS     = -L/soft/libraries/essl/current/lib64/ -L/soft/libraries/alcf/current/xl/LAPACK/lib  -L/soft/libraries/alcf/current/xl/SCALAPACK/lib -L/gpfs/vesta-home/wjiang/fftw3_double/lib -lscalapack -llapack -lesslsmpbg -lfftw3 -lfftw3_omp /gpfs/vesta-home/wjiang/libint/lib/libderiv.a /gpfs/vesta-home/wjiang/libint/lib/libint.a /soft/compilers/ibmcmp-nov2012/vacpp/bg/12.1/lib/libibmc++.a /bgsys/drivers/ppcfloor/gnu-linux/powerpc64-bgq-linux/lib/libstdc++.a -lmass -lmassv -lmass_simd
 
OBJECTS_ARCHITECTURE = machine_aix.o
'''



fails in hfx_screening_methods.f90 with  -qsmp=omp:noauto
